#!/bin/bash

echo "üîÑ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ..."
apt update && apt install -y curl git unzip jq
npm install -g cors-anywhere
curl -s https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip -o ngrok.zip && unzip ngrok.zip && mv ngrok /usr/local/bin

echo "üöÄ –ó–∞–ø—É—Å–∫–∞—î–º–æ CORS Anywhere..."
cors-anywhere --port 8080 --cors-anywhere.allow-origin '*' --cors-anywhere.require-header '' &

echo "üåç –ó–∞–ø—É—Å–∫–∞—î–º–æ ngrok..."
ngrok http 8080 > ngrok.log &
sleep 5

echo "üîç –û—Ç—Ä–∏–º—É—î–º–æ ngrok URL..."
NGROK_URL=$(curl -s http://127.0.0.1:4040/api/tunnels | jq -r '.tunnels[0].public_url')
echo "$NGROK_URL" >> proxy.txt
echo "‚úÖ –û—Ç—Ä–∏–º–∞–Ω–∏–π URL: $NGROK_URL"

echo "üì§ –û–Ω–æ–≤–ª—é—î–º–æ Git..."
git config --global user.email "reiclid@gmail.com"
git config --global user.name "Reiclid"
git pull --rebase
git add proxy.txt
git commit -m "Auto-update proxy URL"
git remote set-url origin git@github.com:Reiclid/rozklad.ztu.edu.ua.git
git push origin main

echo "üéâ –£—Å–ø—ñ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–æ! –¢–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î 24/7."

# –¢—Ä–∏–º–∞—î–º–æ –ø—Ä–æ—Ü–µ—Å –∞–∫—Ç–∏–≤–Ω–∏–º
while true; do sleep 30; done
