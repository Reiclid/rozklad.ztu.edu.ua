<!DOCTYPE html>
<html lang="uk">

<head>
  <meta charset="UTF-8">
  <title>–†–æ–∑–∫–ª–∞–¥ –≥—Ä—É–ø (–Ü–ü–ó, –í–¢, –ö–ù)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="face.png">

  <!-- Open Graph (OG) —Ç–µ–≥–∏ –¥–ª—è —Å–æ—Ü–º–µ—Ä–µ–∂ -->
  <meta property="og:url" content="https://reiclid.github.io/rozklad.ztu.edu.ua/">
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://i.imgur.com/YbjxjPD.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="–†–æ–∑–∫–ª–∞–¥-–≥—Ä—É–ø">
  <meta property="og:title" content="–†–æ–∑–∫–ª–∞–¥ –≥—Ä—É–ø (–Ü–ü–ó, –í–¢, –ö–ù)">
  <meta property="og:description" content="–û–±–µ—Ä—ñ—Ç—å —Å–≤–æ—é –≥—Ä—É–ø—É —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥ –∑–∞–Ω—è—Ç—å!">


  <!-- Twitter Card (–¥–ª—è Twitter/X) -->
  <!-- <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="–†–æ–∑–∫–ª–∞–¥ –≥—Ä—É–ø (–Ü–ü–ó, –í–¢, –ö–ù)">
    <meta name="twitter:description" content="–û–±–µ—Ä—ñ—Ç—å —Å–≤–æ—é –≥—Ä—É–ø—É —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥ –∑–∞–Ω—è—Ç—å!">
    <meta name="twitter:image" content="https://i.imgur.com/YbjxjPD.png">
    <meta name="twitter:url" content="https://reiclid.github.io/rozklad.ztu.edu.ua/"> -->
</head>

<body>
  <div class="container">
    <h1>–†–æ–∑–∫–ª–∞–¥ –≥—Ä—É–ø</h1>
    <header>

    </header>
    <main>
      <div id="scheduleContainer">
        <!-- –†–æ–∑–∫–ª–∞–¥ –≤—ñ–¥–æ–±—Ä–∞–∑–∏—Ç—å—Å—è —É –≤–∏–≥–ª—è–¥—ñ –∫–∞—Ä—Ç–æ–∫ -->
      </div>
    </main>
    <nav>
      <div id="groupContainer">
        <div id="groupScroll">
          <!-- –ì—Ä—É–ø–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>

      <ul id="dayMenu">
        <li data-full="–ü–æ–Ω–µ–¥—ñ–ª–æ–∫" data-short="–ü–Ω"></li>
        <li data-full="–í—ñ–≤—Ç–æ—Ä–æ–∫" data-short="–í—Ç"></li>
        <li data-full="–°–µ—Ä–µ–¥–∞" data-short="–°—Ä"></li>
        <li data-full="–ß–µ—Ç–≤–µ—Ä" data-short="–ß—Ç"></li>
        <li data-full="–ü'—è—Ç–Ω–∏—Ü—è" data-short="–ü—Ç"></li>
        <li data-full="–°—É–±–æ—Ç–∞" data-short="–°–±"></li>
        <li data-full="–ù–µ–¥—ñ–ª—è" data-short="–ù–¥"></li>
        <li data-full="–í—Å–µ" data-short="–í—Å–µ"></li>
      </ul>
    </nav>
    <footer>
      <p>by reiclid</p>
    </footer>

  </div>

  <script>
    async function getProxyUrl() {
      try {
        const response = await fetch('proxy.txt');
        const text = await response.text();
        const urls = text
          .split(/\r?\n/)
          .map(url => url.trim().replace(/^["']|["']$/g, '')) // –í–∏–¥–∞–ª—è—î–º–æ –ª–∞–ø–∫–∏ –∑ –ø–æ—á–∞—Ç–∫—É —ñ –∫—ñ–Ω—Ü—è
          .filter(url => url.length > 0); // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ —Ä—è–¥–∫–∏

        for (const url of urls) {
          if (!url) continue; // –Ü–≥–Ω–æ—Ä—É—î–º–æ –ø—É—Å—Ç—ñ —Ä—è–¥–∫–∏
          console.log(`üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ URL: ${url}`);
          try {
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ä–µ–∂–∏–º "no-cors", —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –±—Ä–∞—É–∑–µ—Ä–æ–º
            const checkResponse = await fetch(url + '/iscorsneeded', { method: 'GET', mode: 'no-cors' });

            // –Ø–∫—â–æ fetch –Ω–µ –≤–∏–∫–∏–Ω—É–≤ –ø–æ–º–∏–ª–∫—É, –≤–≤–∞–∂–∞—î–º–æ –ø—Ä–æ–∫—Å—ñ —Ä–æ–±–æ—á–∏–º
            console.log(`‚úÖ –†–æ–±–æ—á–∏–π URL –∑–Ω–∞–π–¥–µ–Ω–æ: ${url}`);
            return url.endsWith('/') ? url : url + '/'; // –ü–µ—Ä–µ–∫–æ–Ω—É—î–º–æ—Å—è, —â–æ —î `/` –≤ –∫—ñ–Ω—Ü—ñ
          } catch (err) {
            console.warn(`‚ùå URL –Ω–µ –ø—Ä–∞—Ü—é—î: ${url}`, err);
          }
        }

        throw new Error("‚ùå –ù–µ–º–∞—î —Ä–æ–±–æ—á–∏—Ö –ø—Ä–æ–∫—Å—ñ!");
      } catch (err) {
        console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–æ–∫—Å—ñ URL:", err);
        return null;
      }
    }

    let proxyUrl = '';
    let baseUrl = '';
    let groupListUrl = '';

    getProxyUrl().then(url => {
      if (url) {
        proxyUrl = url;
        console.log("üü¢ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Proxy URL –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ:", proxyUrl);
        baseUrl = 'https://rozklad.ztu.edu.ua';
        console.log("üü¢ baseList URL –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ:", baseUrl);
        groupListUrl = proxyUrl + 'proxy?url=https://rozklad.ztu.edu.ua/schedule/group/list';
        console.log("üü¢ groupList URL –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ:", groupListUrl);
        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ proxyUrl –≤ —ñ–Ω—à–∏—Ö —á–∞—Å—Ç–∏–Ω–∞—Ö –∫–æ–¥—É
        loadGroups().then(() => {
          const selectedGroupUrl = localStorage.getItem("selectedGroup");
          if (selectedGroupUrl) {
            console.log(`üîÑ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ä–æ–∑–∫–ª–∞–¥ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó –≥—Ä—É–ø–∏: ${selectedGroupUrl}`);
            loadSchedule(selectedGroupUrl);
          } else {
            console.warn("‚ö† –ù–µ–º–∞—î –≤–∏–±—Ä–∞–Ω–æ—ó –≥—Ä—É–ø–∏. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å –≥—Ä—É–ø—É.");
          }
        });
        populateDayMenu();
        updateDayNames();
      } else {
        console.error("üö® –ù–µ–º–∞—î —Ä–æ–±–æ—á–æ–≥–æ –ø—Ä–æ–∫—Å—ñ!");
      }
    });

    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–∫—Å—ñ —ñ –±–∞–∑–æ–≤–∏—Ö URL
    //const proxyUrl = 'https://60a1-193-194-126-219.ngrok-free.app/';


    const groupSelect = document.getElementById('groupSelect');
    const dayMenu = document.getElementById('dayMenu');
    const scheduleContainer = document.getElementById('scheduleContainer');
    const days = ['–ü–æ–Ω–µ–¥—ñ–ª–æ–∫', '–í—ñ–≤—Ç–æ—Ä–æ–∫', '–°–µ—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä', "–ü'—è—Ç–Ω–∏—Ü—è", '–°—É–±–æ—Ç–∞', '–ù–µ–¥—ñ–ª—è', '–í—Å–µ'];
    const groupScroll = document.getElementById('groupScroll');



    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    const isReload = (() => {
      try {
        return performance.getEntriesByType("navigation")[0].type === "reload";
      } catch {
        return performance.navigation?.type === performance.navigation.TYPE_RELOAD;
      }
    })();

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∏–±—Ä–∞–Ω–æ–≥–æ –¥–Ω—è –∑ localStorage
    let selectedDayIndex = parseInt(localStorage.getItem('selectedDayIndex')) || 0;

    function showLoader() {
      return '<div class="loader">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>';
    }

    function showError(message) {
      return `<div class="error-message">${message}</div>`;
    }

    function populateDayMenu() {
      console.log("üìå –ó–∞–ø–æ–≤–Ω—é—î–º–æ –º–µ–Ω—é –¥–Ω—ñ–≤");
      dayMenu.innerHTML = days
        .map((day, index) => `
          <li data-index="${index}" 
              class="${index === selectedDayIndex ? 'active' : ''}"
              onclick="selectDay(${index})">
            ${day}
          </li>
        `).join('');
    }

    function selectDay(index) {
      console.log(`üìå –í–∏–±—Ä–∞–Ω–æ –¥–µ–Ω—å: ${days[index]}`);
      selectedDayIndex = index;
      localStorage.setItem('selectedDayIndex', index);
      updateDayMenu();

      localStorage.removeItem(`cachedSchedule_${localStorage.getItem("selectedGroup")}_${selectedDayIndex}`);


      // –û—Ç—Ä–∏–º—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É –≥—Ä—É–ø—É
      const selectedGroupUrl = localStorage.getItem("selectedGroup");

      if (selectedGroupUrl) {
        console.log(`üîÑ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ä–æ–∑–∫–ª–∞–¥ –¥–ª—è –≤–∏–±—Ä–∞–Ω–æ—ó –≥—Ä—É–ø–∏: ${selectedGroupUrl}`);
        loadSchedule(selectedGroupUrl);
      } else {
        console.warn("‚ùå –ù–µ–º–∞—î –≤–∏–±—Ä–∞–Ω–æ—ó –≥—Ä—É–ø–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–∑–∫–ª–∞–¥—É!");
      }
    }

    function updateDayMenu() {
      console.log("üìå –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤ –¥–ª—è –≤–∏–±—Ä–∞–Ω–æ–≥–æ –¥–Ω—è");
      dayMenu.querySelectorAll('li').forEach(item => {
        item.classList.toggle('active', parseInt(item.dataset.index) === selectedDayIndex);
      });
    }

    function populateGroupScroll(groups) {
      console.log("üìå –ó–∞–ø–æ–≤–Ω—é—î–º–æ —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø", groups);
      const groupScroll = document.getElementById('groupScroll');
      if (!groupScroll) {
        console.error("‚ùå –ü–æ–º–∏–ª–∫–∞: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä—É–ø –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!");
        return;
      }

      groupScroll.innerHTML = groups.map(group => `
          <div class="group-item" data-href="${group.href}">${group.name}</div>
      `).join('');

      // –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–±—Ä–∞–Ω–æ—ó –≥—Ä—É–ø–∏
      const storedGroup = localStorage.getItem('selectedGroup');
      if (storedGroup) {
        document.querySelectorAll('.group-item').forEach(item => {
          if (item.dataset.href === storedGroup) {
            item.classList.add('active');
          }
        });
      }

      // –î–æ–¥–∞—î–º–æ –ø–æ–¥—ñ—ó –∫–ª—ñ–∫—É –¥–ª—è –≤–∏–±–æ—Ä—É –≥—Ä—É–ø–∏
      document.querySelectorAll('.group-item').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.group-item').forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          localStorage.setItem('selectedGroup', item.dataset.href);
          loadSchedule(item.dataset.href);
        });
      });
    }

    async function loadGroups() {
      if (!proxyUrl) {
        console.log("‚è≥ –û—á—ñ–∫—É—î–º–æ proxyUrl –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –≥—Ä—É–ø...");
        setTimeout(loadGroups, 500); // –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥–∏
        return;
      }

      try {
        console.log("üîÑ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≥—Ä—É–ø–∏ –∑ —Å–µ—Ä–≤–µ—Ä–∞:", groupListUrl);

        const response = await fetch(groupListUrl, {
          mode: "cors",
          headers: {
            "ngrok-skip-browser-warning": "true",
            "X-Requested-With": "XMLHttpRequest"
          }
        });

        if (!response.ok) throw new Error(`‚ùå –°–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä–Ω—É–≤ –ø–æ–º–∏–ª–∫—É: ${response.status}`);

        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        const groups = Array.from(doc.querySelectorAll('.courses-list .groups-list a'))
          .filter(anchor => /^(–Ü–ü–ó(?!–∫)|–í–¢(?!–∫)|–ö–ù(?!–∫))/.test(anchor.textContent.trim()))
          .map(anchor => ({
            name: anchor.textContent.trim(),
            href: new URL(anchor.getAttribute('href'), baseUrl).toString()
          }));

        localStorage.setItem('cachedGroups', JSON.stringify(groups));
        populateGroupScroll(groups);


        const groupScroll = document.getElementById("groupScroll");
        const urlHash = decodeURIComponent(window.location.hash.substring(1));
        if (urlHash) {
          const parts = urlHash.split("/");
          if (parts.length === 3) {
            const savedScroll = parts[2];
            console.log(`üîÑ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å–∫—Ä–æ–ª –∑ —Ö–µ—à—É: ${savedScroll}`);
            groupScroll.scrollLeft = savedScroll || 0;
          }
        } else {
          const savedScroll = localStorage.getItem("groupScrollPosition");
          if (savedScroll !== null) {
            console.log(`üîÑ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å–∫—Ä–æ–ª –∑ localStorage: ${savedScroll}`);
            groupScroll.scrollLeft = savedScroll;
          }
        }

      } catch (err) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä—É–ø:', err);
        groupSelect.innerHTML = '<option value="">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä—É–ø</option>';
      }
    }


    async function loadSchedule(selectedGroupUrl) {
      if (!selectedGroupUrl) {
        console.warn("‚ùå –ù–µ–º–∞—î –≤–∏–±—Ä–∞–Ω–æ—ó –≥—Ä—É–ø–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–∑–∫–ª–∞–¥—É!");
        scheduleContainer.innerHTML = '';
        return;
      }

      const selectedGroupName = document.querySelector(`.group-item[data-href="${selectedGroupUrl}"]`)?.textContent || "–û–±—Ä–∞–Ω–∞ –≥—Ä—É–ø–∞";
      const isAllDays = selectedDayIndex === days.length - 1; // –Ø–∫—â–æ –æ–±—Ä–∞–Ω–æ "–í—Å–µ"
      const scheduleCacheKey = `cachedSchedule_${selectedGroupUrl}_${selectedDayIndex}`;

      console.log(`üìå –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ä–æ–∑–∫–ª–∞–¥ –¥–ª—è ${selectedGroupName} (${days[selectedDayIndex]})`);

      const cachedSchedule = localStorage.getItem(scheduleCacheKey);
      if (cachedSchedule && !isAllDays) {
        console.log("‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫–µ—à–æ–≤–∞–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥");
        scheduleContainer.innerHTML = cachedSchedule;
        return;
      }

      scheduleContainer.innerHTML = showLoader();

      try {
        console.log("üîÑ –ó–∞–ø–∏—Ç —Ä–æ–∑–∫–ª–∞–¥—É –∑ —Å–µ—Ä–≤–µ—Ä–∞...", selectedGroupUrl);
        const response = await fetch(`http://localhost:8080/proxy?url=${encodeURIComponent(selectedGroupUrl)}`, {
          method: "GET",
          credentials: "include",
          // mode: "cors",
          // headers: {
          //   "ngrok-skip-browser-warning": "true",
          //   "X-Requested-With": "XMLHttpRequest",
          //   "Cookie": "PHPSESSID=3u4qtcdb9l8k48ujeok0tushjm"
          // }
            
        })
        

        if (!response.ok) throw new Error(`‚ùå –°–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä–Ω—É–≤ –ø–æ–º–∏–ª–∫—É: ${response.status}`);

        const html = await response.text();
        console.log("‚úÖ –û—Ç—Ä–∏–º–∞–Ω–æ HTML —Ä–æ–∑–∫–ª–∞–¥—É");
        const doc = new DOMParser().parseFromString(html, 'text/html');

        const table = doc.querySelector('.wrapper table.schedule');
        if (!table) throw new Error('‚ùå –†–æ–∑–∫–ª–∞–¥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');

        let scheduleHTML = `<h2>–†–æ–∑–∫–ª–∞–¥ –¥–ª—è ${selectedGroupName} (${isAllDays ? "–í—Å—ñ –¥–Ω—ñ" : days[selectedDayIndex]})</h2>`;

        if (isAllDays) {
          // –í–∏–≤–æ–¥–∏–º–æ –≤—Å—ñ –¥–Ω—ñ, –∞–ª–µ —Ç—ñ–ª—å–∫–∏ —Ç—ñ –ø–∞—Ä–∏, —è–∫—ñ –º–∞—é—Ç—å –∑–∞–Ω—è—Ç—Ç—è
          days.slice(0, -1).forEach((day, index) => {
            let daySchedule = Array.from(table.querySelectorAll('tbody tr'))
              .map(row => {
                const hourTh = row.querySelector('th.hour-name');
                if (!hourTh) return '';

                const periodNumber = hourTh.querySelector('.name')?.textContent.trim() || '';
                const timeRange = hourTh.querySelector('.full-name')?.textContent.trim() || '';
                const pairsCell = row.querySelectorAll('td')[index];

                if (!pairsCell) return ''; // –ü–µ—Ä–µ–∫–æ–Ω—É—î–º–æ—Å—è, —â–æ –∫–æ–º—ñ—Ä–∫–∞ —ñ—Å–Ω—É—î

                // –û—Ç—Ä–∏–º—É—î–º–æ –≤–º—ñ—Å—Ç —Ç–∞ –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –∑–∞–π–≤—ñ –ø—Ä–æ–±—ñ–ª–∏
                const details = pairsCell.textContent.trim();

                // –Ø–∫—â–æ –≤ –ø–∞—Ä—ñ –Ω–µ–º–∞—î –∫–æ–Ω—Ç–µ–Ω—Ç—É (–ø–æ—Ä–æ–∂–Ω—å–æ –∞–±–æ —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ–±—ñ–ª–∏) ‚Äî –Ω–µ –¥–æ–¥–∞—î–º–æ
                return details && details !== "" ? `
                            <div class="schedule-card">
                                <h3>${day} ‚Äì –ü–∞—Ä–∞ ${periodNumber} (${timeRange})</h3>
                                <p>${pairsCell.innerHTML.trim()}</p>
                            </div>
                        ` : '';
              })
              .join('');

            if (daySchedule.trim() !== '') {
              scheduleHTML += `<h3>${day}</h3>` + daySchedule;
            }
          });
          scheduleContainer.innerHTML = scheduleHTML;
          localStorage.setItem(scheduleCacheKey, scheduleHTML);

        } else {
          // –Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –¥–µ–Ω—å, –ø—Ä–∞—Ü—é—î–º–æ —è–∫ —Ä–∞–Ω—ñ—à–µ
          const scheduleItems = Array.from(table.querySelectorAll('tbody tr'))
            .map(row => {
              const hourTh = row.querySelector('th.hour-name');
              if (!hourTh) return '';

              const periodNumber = hourTh.querySelector('.name')?.textContent.trim() || '';
              const timeRange = hourTh.querySelector('.full-name')?.textContent.trim() || '';
              const pairsCell = row.querySelectorAll('td')[selectedDayIndex];

              if (!pairsCell) return '';

              // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –≤ –ø–∞—Ä—ñ –∫–æ–Ω—Ç–µ–Ω—Ç
              const details = pairsCell.textContent.trim();

              if (!details) return '';

              return `
                        <div class="schedule-card">
                            <h3>${days[selectedDayIndex]} ‚Äì –ü–∞—Ä–∞ ${periodNumber} (${timeRange})</h3>
                            <p>${pairsCell.innerHTML.trim()}</p>
                        </div>
                    `;
            })
            .filter(item => item !== '')
            .join('');

          const scheduleWithHeader = `<h2>–†–æ–∑–∫–ª–∞–¥ –¥–ª—è ${selectedGroupName} (${days[selectedDayIndex]})</h2>`;

          scheduleContainer.innerHTML = scheduleItems
            ? scheduleWithHeader + scheduleItems
            : showError("–ù–µ–º–∞—î –ø–∞—Ä –Ω–∞ —Ü–µ–π –¥–µ–Ω—å");

          localStorage.setItem(scheduleCacheKey,
            scheduleItems
              ? scheduleWithHeader + scheduleItems
              : showError("–ù–µ–º–∞—î –ø–∞—Ä –Ω–∞ —Ü–µ–π –¥–µ–Ω—å")
          );
        }



        // Array.from(table.querySelectorAll('tbody tr')).forEach((row, i) => {
        //     const cells = row.querySelectorAll('td');
        //     console.log(`–†—è–¥–æ–∫ ${i}: –¥–ª—è –¥–Ω—è ${days[selectedDayIndex]} (—ñ–Ω–¥–µ–∫—Å ${selectedDayIndex}) innerHTML:`, cells[selectedDayIndex]?.innerHTML);
        // });
      } catch (err) {
        console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–∑–∫–ª–∞–¥—É:", err);
        scheduleContainer.innerHTML = showError("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–∑–∫–ª–∞–¥—É");
      }
    }


    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    populateDayMenu();
    loadGroups();

    // –ü–æ–¥—ñ—ó
    // groupSelect.addEventListener('change', () => {
    //   localStorage.setItem('selectedGroup', groupSelect.value);
    //   loadSchedule();
    // });

    document.addEventListener("click", (event) => {
      const selectedGroup = event.target.closest(".group-item");
      if (!selectedGroup) return;

      document.querySelectorAll(".group-item").forEach(item => item.classList.remove("active"));
      selectedGroup.classList.add("active");

      const selectedGroupUrl = selectedGroup.dataset.href;
      localStorage.setItem("selectedGroup", selectedGroupUrl); // ‚úÖ –ó–ë–ï–†–Ü–ì–ê–Ñ–ú–û –≥—Ä—É–ø—É
      console.log("üîÑ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ä–æ–∑–∫–ª–∞–¥ –¥–ª—è –≥—Ä—É–ø–∏:", selectedGroupUrl);

      // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ä–æ–∑–∫–ª–∞–¥ –¥–ª—è –≤–∏–±—Ä–∞–Ω–æ—ó –≥—Ä—É–ø–∏
      loadSchedule(selectedGroupUrl);
    });


    function updateCardEffects() {
      const cards = document.querySelectorAll('.schedule-card');
      const viewportHeight = window.innerHeight;

      cards.forEach(card => {
        const rect = card.getBoundingClientRect();
        const cardCenter = rect.top + rect.height / 2;
        const viewportCenter = viewportHeight / 2;

        // –í—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ —Ü–µ–Ω—Ç—Ä—É –µ–∫—Ä–∞–Ω—É
        const distanceFromCenter = cardCenter - viewportCenter;

        // –ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ —Ü–µ–Ω—Ç—Ä—É (-1 = –≤–µ—Ä—Ö, 1 = –Ω–∏–∑)
        const normalizedDistance = distanceFromCenter / viewportHeight;

        // –í–∏–∑–Ω–∞—á–∞—î–º–æ –º–∞—Å—à—Ç–∞–± (–≤—ñ–¥ 1 –¥–æ 0.8)
        let scale = 1 - Math.min(Math.abs(normalizedDistance) * 0.2, 0.2);

        // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∫—É—Ç –Ω–∞—Ö–∏–ª—É (–≤—ñ–¥ -20deg –¥–æ 20deg)
        // let tilt = Math.min(Math.max(normalizedDistance * 20, -20), 20);

        // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å –¥–ª—è –ø–ª–∞–≤–Ω–æ—ó –∞–Ω—ñ–º–∞—Ü—ñ—ó
        if (Math.abs(normalizedDistance) < 0.5) {
          card.classList.add('in-view');
        } else {
          card.classList.remove('in-view');
        }

        // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ —Å—Ç–∏–ª—ñ
        card.style.transform = `scale(${scale})`;
        card.style.opacity = scale * scale;
      });
    }

    // –í–∏–∫–ª–∏–∫–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—á—É–≤–∞–Ω–Ω—ñ
    window.addEventListener('scroll', updateCardEffects);
    window.addEventListener('resize', updateCardEffects);
    document.addEventListener('DOMContentLoaded', updateCardEffects);

    function updateDayNames() {
      const isMobile = window.innerWidth < 768;
      document.querySelectorAll("#dayMenu li").forEach((li, index) => {
        const fullNames = ["–ü–æ–Ω–µ–¥—ñ–ª–æ–∫", "–í—ñ–≤—Ç–æ—Ä–æ–∫", "–°–µ—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä", "–ü'—è—Ç–Ω–∏—Ü—è", "–°—É–±–æ—Ç–∞", "–ù–µ–¥—ñ–ª—è", "–í—Å–µ"];
        const shortNames = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–ù–¥", "–í—Å–µ"];

        li.textContent = isMobile ? shortNames[index] : fullNames[index];
      });
    }


    window.addEventListener("DOMContentLoaded", updateDayNames);
    window.addEventListener("resize", updateDayNames);





    function load_scroll() {
      const groupScroll = document.getElementById("groupScroll");
      console.log("üìå DOMContentLoaded: –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è...");

      function updateURLHash() {
        const selectedGroup = localStorage.getItem("selectedGroup") || "";
        const selectedDay = localStorage.getItem("selectedDayIndex") || 0;
        const scrollPosition = groupScroll.scrollLeft || 0;

        const newHash = `#${encodeURIComponent(selectedGroup)}/${selectedDay}/${scrollPosition}`;
        history.replaceState(null, null, newHash);
        console.log(`üîó URL –æ–Ω–æ–≤–ª–µ–Ω–æ: ${newHash}`);
      }

      groupScroll.addEventListener("scroll", () => {
        localStorage.setItem("groupScrollPosition", groupScroll.scrollLeft);
        console.log(`üíæ –ó–±–µ—Ä–µ–∂–µ–Ω–æ —Å–∫—Ä–æ–ª: ${groupScroll.scrollLeft}`);
        updateURLHash();
      });

      function restoreFromURLHash() {
        const urlHash = decodeURIComponent(window.location.hash.substring(1));
        console.log(`üîç –ê–Ω–∞–ª—ñ–∑—É—î–º–æ —Ö–µ—à URL: ${urlHash}`);

        if (urlHash) {
          const [savedGroup, savedDay, savedScroll] = urlHash.split("/");

          console.log(`üìù –†–æ–∑–ø—ñ–∑–Ω–∞–Ω–æ: –ì—Ä—É–ø–∞=${savedGroup}, –î–µ–Ω—å=${savedDay}, –°–∫—Ä–æ–ª=${savedScroll}`);

          if (savedGroup) {
            const groupElement = document.querySelector(`.group-item[data-href="${savedGroup}"]`);
            if (groupElement) {
              console.log(`‚úÖ –ì—Ä—É–ø—É –∑–Ω–∞–π–¥–µ–Ω–æ: ${savedGroup}, –≤–∏–¥—ñ–ª—è—î–º–æ...`);
              document.querySelectorAll(".group-item").forEach(item => item.classList.remove("active"));
              groupElement.classList.add("active");

              localStorage.setItem("selectedGroup", savedGroup);
              loadSchedule(savedGroup);

              setTimeout(() => {
                console.log(`üîÑ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å–∫—Ä–æ–ª –∑ —Ö–µ—à—É: ${savedScroll}`);
                groupScroll.scrollLeft = savedScroll || 0;
              }, 100);
            } else {
              console.log(`‚ùå –ì—Ä—É–ø—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ DOM: ${savedGroup}`);
            }
          }

          if (savedDay) {
            console.log(`üìÖ –í–∏–±–∏—Ä–∞—î–º–æ –¥–µ–Ω—å: ${savedDay}`);
            selectDay(parseInt(savedDay));
          }
        } else {
          console.log("‚ö† –•–µ—à —É URL –≤—ñ–¥—Å—É—Ç–Ω—ñ–π.");
        }
      }

      restoreFromURLHash();
    };


  </script>
</body>

</html>